<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RaceCraft Dashboard</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <!-- Leaflet.js for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Three.js for 3D Visualizations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #F9FAFB;
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background-color: #EF4444; /* red-500 */
            color: #FFFFFF;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .chart-container, .threed-chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            background-color: #1F2937;
            padding: 1rem;
            border-radius: 0.5rem;
        }
        .threed-chart-container {
             height: 500px;
        }
        #map-container {
            height: 500px;
            border-radius: 0.5rem;
        }
        .leaflet-popup-content-wrapper, .leaflet-popup-tip {
            background: #374151;
            color: #F9FAFB;
            border-radius: 0.5rem;
        }
        .custom-select {
            background-color: #1F2937;
            border: 1px solid #374151;
            color: #F9FAFB;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header -->
    <header class="bg-gray-900/80 backdrop-blur-sm shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <svg class="w-8 h-8 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h12M3.75 3h16.5M3.75 3v1.5M16.5 3v1.5M3.75 16.5a3 3 0 003 3h6a3 3 0 003-3M6.75 19.5v-3h10.5v3M12 12.75a1.125 1.125 0 110-2.25 1.125 1.125 0 010 2.25z" />
                    </svg>
                    <h1 class="text-2xl font-bold text-white ml-2">RaceCraft Dashboard</h1>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Tab Buttons -->
        <div class="mb-8 flex flex-wrap items-center justify-center gap-2">
            <button class="tab-button active px-4 py-2 bg-gray-700 hover:bg-red-600 rounded-md font-semibold" data-tab="overview">Overview</button>
            <button class="tab-button px-4 py-2 bg-gray-700 hover:bg-red-600 rounded-md font-semibold" data-tab="drivers">Driver Analysis</button>
            <button class="tab-button px-4 py-2 bg-gray-700 hover:bg-red-600 rounded-md font-semibold" data-tab="constructors">Constructor Analysis</button>
            <button class="tab-button px-4 py-2 bg-gray-700 hover:bg-red-600 rounded-md font-semibold" data-tab="races">Race Analysis</button>
            <button class="tab-button px-4 py-2 bg-gray-700 hover:bg-red-600 rounded-md font-semibold" data-tab="circuits">Circuit Explorer</button>
            <button class="tab-button px-4 py-2 bg-gray-700 hover:bg-red-600 rounded-md font-semibold" data-tab="threed">3D Analysis</button>
        </div>

        <!-- Tab Content -->
        <div id="tab-content-container">
            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="chart-container lg:col-span-2">
                        <h3 class="text-xl font-bold mb-4 text-center">Races Per Season</h3>
                        <canvas id="races-per-season-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 class="text-xl font-bold mb-4 text-center">Driver Nationalities</h3>
                        <canvas id="driver-nationality-chart"></canvas>
                    </div>
                     <div class="chart-container lg:col-span-3">
                        <h3 class="text-xl font-bold mb-4 text-center">All Time Constructor Wins</h3>
                        <canvas id="constructor-wins-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Driver Analysis Tab -->
            <div id="drivers" class="tab-content">
                 <div class="bg-gray-800 p-4 rounded-lg mb-6">
                    <label for="driver-select" class="block text-sm font-medium text-gray-300 mb-2">Select Driver:</label>
                    <select id="driver-select" class="custom-select block w-full p-2.5 rounded-md"></select>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <h3 class="text-xl font-bold mb-4 text-center">Career Points & Wins</h3>
                        <canvas id="driver-career-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 class="text-xl font-bold mb-4 text-center">Finishing Position Distribution</h3>
                        <canvas id="driver-position-histogram"></canvas>
                    </div>
                </div>
            </div>

            <!-- Constructor Analysis Tab -->
            <div id="constructors" class="tab-content">
                <div class="bg-gray-800 p-4 rounded-lg mb-6">
                    <label for="constructor-select" class="block text-sm font-medium text-gray-300 mb-2">Select Constructor:</label>
                    <select id="constructor-select" class="custom-select block w-full p-2.5 rounded-md"></select>
                </div>
                 <div class="chart-container">
                    <h3 class="text-xl font-bold mb-4 text-center">Points Progression Over Seasons</h3>
                    <canvas id="constructor-points-chart"></canvas>
                </div>
            </div>

            <!-- Race Analysis Tab -->
            <div id="races" class="tab-content">
                 <div class="bg-gray-800 p-4 rounded-lg mb-6">
                    <label for="race-select" class="block text-sm font-medium text-gray-300 mb-2">Select Race:</label>
                    <select id="race-select" class="custom-select block w-full p-2.5 rounded-md"></select>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <h3 class="text-xl font-bold mb-4 text-center">Qualifying vs. Finish Position</h3>
                        <canvas id="qualifying-vs-finish-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 class="text-xl font-bold mb-4 text-center">Lap Time Distribution (Top 5 Drivers)</h3>
                        <canvas id="lap-time-boxplot"></canvas>
                    </div>
                </div>
            </div>

            <!-- Circuit Explorer Tab -->
            <div id="circuits" class="tab-content">
                 <div id="map-container"></div>
            </div>
            
            <!-- 3D Analysis Tab -->
            <div id="threed" class="tab-content">
                <div class="bg-gray-800 p-4 rounded-lg mb-6">
                    <label for="threed-season-select" class="block text-sm font-medium text-gray-300 mb-2">Select Season:</label>
                    <select id="threed-season-select" class="custom-select block w-full p-2.5 rounded-md"></select>
                </div>
                <div class="threed-chart-container">
                    <h3 class="text-xl font-bold mb-4 text-center">3D Scatter Plot: Grid vs Finish vs Points</h3>
                    <div id="threed-scatter-plot" class="w-full h-full"></div>
                </div>
                 <div class="mt-6 text-center text-gray-400">
                    <p>Rotate by dragging the mouse. Zoom with the scroll wheel.</p>
                </div>
            </div>
        </div>
    </main>

    <script>
    // --- Data Store ---
    const dataStore = {};

    // --- Chart Instances ---
    const charts = {};
    let map = null;
    let threeDScene = null;

    // --- Data Loading and Initialization ---
    async function loadDataAndInit() {
        dataStore.drivers = [
            { driverId: '1', forename: 'Lewis', surname: 'Hamilton', nationality: 'British' },
            { driverId: '830', forename: 'Max', surname: 'Verstappen', nationality: 'Dutch' },
            { driverId: '4', forename: 'Fernando', surname: 'Alonso', nationality: 'Spanish'},
            { driverId: '817', forename: 'Daniel', surname: 'Ricciardo', nationality: 'Australian'},
            { driverId: '844', forename: 'Charles', surname: 'Leclerc', nationality: 'Monegasque'},
            { driverId: '822', forename: 'Valtteri', surname: 'Bottas', nationality: 'Finnish'},
        ];
        dataStore.constructors = [
            { constructorId: '131', name: 'Mercedes', nationality: 'German' },
            { constructorId: '9', name: 'Red Bull', nationality: 'Austrian' },
            { constructorId: '6', name: 'Ferrari', nationality: 'Italian' },
            { constructorId: '1', name: 'McLaren', nationality: 'British' },
        ];
        dataStore.races = [
            { raceId: '1074', year: '2022', round: '1', circuitId: '3', name: 'Bahrain Grand Prix' },
            { raceId: '1075', year: '2022', round: '2', circuitId: '24', name: 'Saudi Arabian Grand Prix' },
            { raceId: '1096', year: '2023', round: '23', circuitId: '24', name: 'Abu Dhabi Grand Prix' },
            { raceId: '1098', year: '2023', round: '1', circuitId: '3', name: 'Bahrain Grand Prix' },
        ];
        dataStore.results = [
            { resultId: '25431', raceId: '1074', driverId: '844', constructorId: '6', grid: '1', positionOrder: '1', points: '26', laps: '57' },
            { resultId: '25433', raceId: '1074', driverId: '1', constructorId: '131', grid: '5', positionOrder: '3', points: '15', laps: '57' },
            { resultId: '25881', raceId: '1096', driverId: '830', constructorId: '9', grid: '1', positionOrder: '1', points: '26', laps: '58' },
            { resultId: '25882', raceId: '1096', driverId: '844', constructorId: '6', grid: '2', positionOrder: '2', points: '18', laps: '58' },
             { resultId: '25886', raceId: '1098', driverId: '830', constructorId: '9', grid: '1', positionOrder: '1', points: '25', laps: '57' },
        ];
        dataStore.qualifying = [
           { qualifyId: '9203', raceId: '1074', driverId: '844', constructorId: '6', position: '1' },
           { qualifyId: '9207', raceId: '1074', driverId: '1', constructorId: '131', position: '5' },
           { qualifyId: '9633', raceId: '1096', driverId: '830', constructorId: '9', position: '1' },
        ];
        dataStore.lap_times = [
            { raceId: '1096', driverId: '830', lap: '1', milliseconds: '95000' },
            { raceId: '1096', driverId: '830', lap: '2', milliseconds: '94500' },
            { raceId: '1096', driverId: '844', lap: '1', milliseconds: '95200' },
            { raceId: '1096', driverId: '844', lap: '2', milliseconds: '94800' },
        ];
        dataStore.circuits = [
            { circuitId: '3', name: 'Bahrain International Circuit', location: 'Sakhir', country: 'Bahrain', lat: '26.0325', lng: '50.5106' },
            { circuitId: '24', name: 'Jeddah Corniche Circuit', location: 'Jeddah', country: 'Saudi Arabia', lat: '21.6319', lng: '39.1044' },
            { circuitId: '1', name: 'Albert Park', location: 'Melbourne', country: 'Australia', lat: '-37.8497', lng: '144.968' },
        ];
        dataStore.constructor_standings = [
            { raceId: '1096', constructorId: '9', points: '860', wins: '21' },
            { raceId: '1096', constructorId: '131', points: '409', wins: '0' },
            { raceId: '1074', constructorId: '6', points: '44', wins: '1' },
        ];

        initializeDashboard();
    }

    function initializeDashboard() {
        setupTabs();
        populateSelectors();
        createOverviewCharts();
        createDriverCharts();
        createConstructorCharts();
        createRaceCharts();
        createCircuitMap();
        setup3DAnalysis();

        // Trigger initial chart renders
        document.getElementById('driver-select').dispatchEvent(new Event('change'));
        document.getElementById('constructor-select').dispatchEvent(new Event('change'));
        document.getElementById('race-select').dispatchEvent(new Event('change'));
        document.getElementById('threed-season-select').dispatchEvent(new Event('change'));
    }

    function setupTabs() {
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                tabContents.forEach(content => content.classList.remove('active'));
                document.getElementById(button.dataset.tab).classList.add('active');
                
                if (button.dataset.tab === 'circuits' && map) setTimeout(() => map.invalidateSize(), 10);
                if (button.dataset.tab === 'threed' && threeDScene) threeDScene.onResize();
            });
        });
    }

    function populateSelectors() {
        const driverSelect = document.getElementById('driver-select');
        dataStore.drivers.forEach(d => { driverSelect.innerHTML += `<option value="${d.driverId}">${d.forename} ${d.surname}</option>`; });

        const constructorSelect = document.getElementById('constructor-select');
        dataStore.constructors.forEach(c => { constructorSelect.innerHTML += `<option value="${c.constructorId}">${c.name}</option>`; });

        const raceSelect = document.getElementById('race-select');
        dataStore.races.forEach(r => { raceSelect.innerHTML += `<option value="${r.raceId}">${r.year} - ${r.name}</option>`; });

        const threedSeasonSelect = document.getElementById('threed-season-select');
        const seasons = [...new Set(dataStore.races.map(r => r.year))].sort((a,b) => b-a);
        seasons.forEach(year => { threedSeasonSelect.innerHTML += `<option value="${year}">${year}</option>`; });
    }
    
    // --- Chart Creation Functions (2D) ---
    function createOverviewCharts() {
        const racesByYear = dataStore.races.reduce((acc, race) => { acc[race.year] = (acc[race.year] || 0) + 1; return acc; }, {});
        const years = Object.keys(racesByYear).sort();
        renderChart('races-per-season-chart', 'bar', {
            labels: years,
            datasets: [{ label: 'Number of Races', data: years.map(year => racesByYear[year]), backgroundColor: '#EF4444' }]
        });

        const nationalities = dataStore.drivers.reduce((acc, driver) => { acc[driver.nationality] = (acc[driver.nationality] || 0) + 1; return acc; }, {});
        renderChart('driver-nationality-chart', 'pie', {
            labels: Object.keys(nationalities),
            datasets: [{ data: Object.values(nationalities), backgroundColor: ['#EF4444', '#3B82F6', '#10B981', '#F59E0B', '#8B5CF6'] }]
        });
        
        const constructorWins = dataStore.constructor_standings.reduce((acc, standing) => {
            const constructor = dataStore.constructors.find(c => c.constructorId === standing.constructorId);
            if(constructor) acc[constructor.name] = (acc[constructor.name] || 0) + parseInt(standing.wins);
            return acc;
        }, {});
        renderChart('constructor-wins-chart', 'bar', {
            labels: Object.keys(constructorWins),
            datasets: [{ label: 'Total Wins', data: Object.values(constructorWins), backgroundColor: '#3B82F6' }]
        }, { indexAxis: 'y' });
    }

    function createDriverCharts() {
        const driverSelect = document.getElementById('driver-select');
        driverSelect.addEventListener('change', () => {
            const driverId = driverSelect.value;
            const driverResults = dataStore.results.filter(r => r.driverId === driverId);
            const statsByYear = driverResults.reduce((acc, result) => {
                const race = dataStore.races.find(r => r.raceId === result.raceId);
                if (race) {
                    if (!acc[race.year]) acc[race.year] = { points: 0, wins: 0 };
                    acc[race.year].points += parseFloat(result.points);
                    if (parseInt(result.positionOrder) === 1) acc[race.year].wins++;
                }
                return acc;
            }, {});
            const years = Object.keys(statsByYear).sort();
            renderChart('driver-career-chart', 'bar', {
                labels: years,
                datasets: [
                    { type: 'line', label: 'Points', data: years.map(y => statsByYear[y].points), yAxisID: 'yPoints', borderColor: '#3B82F6', backgroundColor: '#3B82F6' },
                    { type: 'bar', label: 'Wins', data: years.map(y => statsByYear[y].wins), yAxisID: 'yWins', backgroundColor: '#EF4444' }
                ]
            }, { scales: { yPoints: { position: 'right' }, yWins: { position: 'left', ticks: { stepSize: 1 } } } });

            const positions = driverResults.map(r => parseInt(r.positionOrder));
            renderChart('driver-position-histogram', 'bar', {
                labels: [...Array(20).keys()].map(i => i + 1),
                datasets: [{ label: 'Finish Count', data: countOccurrences(positions, 20), backgroundColor: '#10B981' }]
            });
        });
    }

    function createConstructorCharts() {
        const constructorSelect = document.getElementById('constructor-select');
        constructorSelect.addEventListener('change', () => {
            const constructorId = constructorSelect.value;
            const constrResults = dataStore.constructor_standings.filter(cs => cs.constructorId === constructorId);
            const pointsByYear = constrResults.reduce((acc, result) => {
                 const race = dataStore.races.find(r => r.raceId === result.raceId);
                 if(race) acc[race.year] = (acc[race.year] || 0) + parseInt(result.points);
                 return acc;
            }, {});
            const years = Object.keys(pointsByYear).sort();
            renderChart('constructor-points-chart', 'line', {
                labels: years,
                datasets: [{ label: 'Total Points', data: years.map(y => pointsByYear[y]), borderColor: '#F59E0B', tension: 0.1 }]
            });
        });
    }

    function createRaceCharts() {
        const raceSelect = document.getElementById('race-select');
        raceSelect.addEventListener('change', () => {
            const raceId = raceSelect.value;
            const raceQuali = dataStore.qualifying.filter(q => q.raceId === raceId);
            const raceResults = dataStore.results.filter(r => r.raceId === raceId);
            const scatterData = raceQuali.map(q => {
                const result = raceResults.find(r => r.driverId === q.driverId);
                return result ? { x: parseInt(q.position), y: parseInt(result.positionOrder) } : null;
            }).filter(d => d);
            renderChart('qualifying-vs-finish-chart', 'scatter', {
                datasets: [{ label: 'Quali vs Finish', data: scatterData, backgroundColor: '#8B5CF6' }]
            });

            const lapTimes = dataStore.lap_times.filter(lt => lt.raceId === raceId);
            const driversInRace = [...new Set(lapTimes.map(lt => lt.driverId))].slice(0, 5);
            const boxplotData = driversInRace.map(driverId => {
                const driver = dataStore.drivers.find(d => d.driverId === driverId);
                const times = lapTimes.filter(lt => lt.driverId === driverId).map(lt => parseInt(lt.milliseconds));
                return { label: driver.surname, data: times };
            });
            const avgLapData = boxplotData.map(d => d.data.length > 0 ? d.data.reduce((a, b) => a + b, 0) / d.data.length : 0);
            renderChart('lap-time-boxplot', 'bar', {
                labels: boxplotData.map(d => d.label),
                datasets: [{ label: 'Average Lap Time (ms)', data: avgLapData, backgroundColor: '#10B981' }]
            });
        });
    }

    function createCircuitMap() {
        map = L.map('map-container').setView([20, 0], 2);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd', maxZoom: 19
        }).addTo(map);
        dataStore.circuits.forEach(c => {
            L.marker([c.lat, c.lng]).addTo(map).bindPopup(`<b>${c.name}</b><br>${c.location}, ${c.country}`);
        });
    }

    // --- 3D Analysis ---
    function setup3DAnalysis() {
        const container = document.getElementById('threed-scatter-plot');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        scene.background = new THREE.Color(0x1F2937);
        camera.position.z = 30;

        // Add lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 10, 7.5);
        scene.add(directionalLight);

        // Mouse controls
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        container.addEventListener('mousedown', e => { isDragging = true; });
        container.addEventListener('mouseup', e => { isDragging = false; });
        container.addEventListener('mousemove', e => {
            if (!isDragging) return;
            const deltaMove = {
                x: e.offsetX - previousMousePosition.x,
                y: e.offsetY - previousMousePosition.y
            };
            scene.rotation.y += deltaMove.x * 0.01;
            scene.rotation.x += deltaMove.y * 0.01;
            previousMousePosition = { x: e.offsetX, y: e.offsetY };
        });
        container.addEventListener('wheel', e => {
            camera.position.z += e.deltaY * 0.01;
        });


        const animate = function () {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        };
        animate();
        
        threeDScene = { scene, camera, renderer, onResize: () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }};

        document.getElementById('threed-season-select').addEventListener('change', (e) => update3DScatter(e.target.value));
    }

    function update3DScatter(year) {
        if (!threeDScene) return;
        
        // Clear previous points
        while(threeDScene.scene.children.length > 2){ // Keep lights
            threeDScene.scene.remove(threeDScene.scene.children[2]);
        }

        const raceIdsForYear = dataStore.races.filter(r => r.year === year).map(r => r.raceId);
        const resultsForYear = dataStore.results.filter(r => raceIdsForYear.includes(r.raceId));

        const points = [];
        resultsForYear.forEach(r => {
            const grid = parseInt(r.grid);
            const finish = parseInt(r.positionOrder);
            const pts = parseFloat(r.points);
            if (grid > 0 && finish > 0) {
                 points.push({ x: grid, y: finish, z: pts });
            }
        });

        const geometry = new THREE.SphereGeometry(0.3, 16, 16);
        points.forEach(p => {
            const material = new THREE.MeshStandardMaterial({ color: new THREE.Color(`hsl(${200 - p.z * 5}, 100%, 50%)`) });
            const sphere = new THREE.Mesh(geometry, material);
            // Normalize positions to fit in the view
            sphere.position.set((p.x - 10), (p.y - 10), (p.z - 10));
            threeDScene.scene.add(sphere);
        });
    }


    // --- Utility Functions ---
    function renderChart(canvasId, type, data, options = {}) {
        if (charts[canvasId]) charts[canvasId].destroy();
        const ctx = document.getElementById(canvasId).getContext('2d');
        charts[canvasId] = new Chart(ctx, { type, data, options: { ...getGlobalChartOptions(), ...options } });
    }

    function getGlobalChartOptions() {
        return {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { labels: { color: '#F9FAFB' } } },
            scales: {
                x: { ticks: { color: '#D1D5DB' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                y: { ticks: { color: '#D1D5DB' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
            }
        };
    }

    function countOccurrences(arr, maxValue) {
        const counts = new Array(maxValue + 1).fill(0);
        arr.forEach(val => { if (val <= maxValue) counts[val]++; });
        return counts.slice(1);
    }

    // --- Entry Point ---
    document.addEventListener('DOMContentLoaded', loadDataAndInit);
    </script>
</body>
</html>
